---
title: "Exercício Made"
author: "Almirêz Colombani Bispo de Almeida"
date: "2025-05-13"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Inicializar as bibliotecas

```{r , include=FALSE }
library("dplyr")
library("ggplot2")
```

## Abrir base

```{r}

data <- read.csv("base.csv") #abri base que se encontra no mesmo diretório do projeto
View(data) # ver como a base foi importada

head(data, n = 10) # vizualizar algumas linhas e tipos de variáveis

```

## Limpar base

instruções: não utilizar pesos amostrais, agregar "pretos" e "pardos" em "Negros", retirar observações com raça "ignorada"

OBS: também tirei observações com renda total "Na"/0 porque pelo dicionário da Pnadc isso significa que não se aplica, isto é, pode estar desempregado ou não estar procurando emprego e não tem outra fonte de renda, por exemplo. Como o objeto de análise parece ser a desigualdade de renda vou retirar, mas a análise dessa ocorrência pode indicar outras questões (recorte sobre o trabalho principal ou sem retirar ocorrências de desemprego e outras fontes de renda).

```{r echo=FALSE}
#Tirar raca "ignorado" e agrega pardo e pretos em negros
base <- data |> filter(raca != "Ignorado") |> mutate(raca = case_when( 
      raca %in% c("Preta", "Parda") ~ "Negros",                
      TRUE ~ raca #para todos os outros casos, repete o que já está
                                                                    )) 

#Verificar se não houve nenhum engano
sum(data$raca %in% c("Preta","Parda")) == sum(base$raca == "Negros")

#Tirar observações em que renda total igual a 0/Na (base com alguma renda)
baseCR <- base |> filter(!is.na(rendimento_todas_fontas) & rendimento_todas_fontas != 0)

baseCRT <- base |> filter(!is.na(rend_trabalho_principal) & rend_trabalho_principal != 0)

#Bases filtradas em relação a base original
nrow(baseCRT)/nrow(data) #0.5198853
nrow(baseCR)/nrow(data) # 0.803298
nrow(base)/nrow(data) #0.9999172


#proporção raca

prop_raca <-  base |> count(raca) |> mutate(prop = n/sum(n) )

#proporção gênero

prop_genero <-  base |> count(sexo) |> mutate(prop = n/sum(n) )

#Distribuição de renda

#Sexo (Com Renda Total)
ggplot(baseCR , aes(x = rendimento_todas_fontas, fill= sexo)) +
  geom_histogram() +
  scale_x_log10() +  # Escala logarítmica para melhor visualização
  labs(
    title = "Distribuição de Renda Total por Sexo",
    x = "Renda (escala log10)",
    y = ""
  ) +
  facet_wrap(~sexo, scales = "free_y", ncol = 1) + # Facetas separadas, free_y porque alguns grupos têm menor representatividade e a ideia é comparar a distribuição
  theme_minimal()


#Sexo (Com Renda Total)
ggplot(baseCR , aes(x = rendimento_todas_fontas, fill= raca)) +
  geom_histogram() +
  scale_x_log10() +  # Escala logarítmica para melhor visualização
  labs(
    title = "Distribuição de Renda Total por Raça",
    x = "Renda (escala log10)",
    y = ""
  ) +
  facet_wrap(~raca, scales = "free_y", ncol = 1) + # Facetas separadas, free_y porque alguns grupos têm menor representatividade e a ideia é comparar a distribuição
  theme_minimal()

#Sexo (Com Rendimento do Trabalho)
ggplot(baseCRT , aes(x = rend_trabalho_principal, fill= sexo)) +
  geom_histogram() +
  scale_x_log10() +  # Escala logarítmica para melhor visualização
  labs(
    title = "Distribuição de Renda do Trabalho por Sexo",
    x = "Renda (escala log10)",
    y = ""
  ) +
  facet_wrap(~sexo, scales = "free_y", ncol = 1) + # Facetas separadas, free_y porque alguns grupos têm menor representatividade e a ideia é comparar a distribuição por raça, e coloquei em uma coluna porque estava com dificuldade de vizualizar a diferença em mais colunas, mas dá para mudar o "ncol"
  theme_minimal()

#Raça (Com Rendimento do trbalho)
ggplot(baseCRT , aes(x = rend_trabalho_principal, fill= raca)) +
  geom_histogram() +
  scale_x_log10() +  # Escala logarítmica para melhor visualização
  labs(
    title = "Distribuição de Renda do Trabalho por Raça",
    x = "Renda (escala log10)",
    y = ""
  ) +
  facet_wrap(~raca, scales = "free_y", ncol = 1) + # Facetas separadas, free_y porque alguns grupos têm menor representatividade e a ideia é comparar a distribuição por raça, e coloquei em uma coluna porque estava com dificuldade de vizualizar a diferença em mais colunas, mas dá para mudar o "ncol"
  theme_minimal()


####deixei o ggplot dividir os "bins" automáticamente (ficou dividido em 30 intervalos iguais)

```

## Tabela Descritiva

instruções: comparar rendimentos totais e do trabalho por raça e gênero (deve utilizar estatísticas como média, mediana, etc)

Adicionei o desvio padrão

```{r echo=FALSE}

trabalho <- base[,c(1,3,4,5)] #excluí a variável renda total

total <- base[,c(1,2,4,5)] #excluí a variável renda do trabalho principal


#Calcular média, mediana, desvio padrão, 5º percentil, 1º quartil, 3º quartil, 95º percentil, mínimo, máximo e número de observações (n) para a renda do trabalho principal (genero e sexo)
r_trabalho <- trabalho  |> filter(!is.na(rend_trabalho_principal) & rend_trabalho_principal != 0) |> group_by( raca, sexo) |> 
        summarise(  media = mean(rend_trabalho_principal),                                                                  mediana = median(rend_trabalho_principal) , 
                    dp = sd(rend_trabalho_principal),
                    p5 = quantile(rend_trabalho_principal, probs = 0.05), #5º percentil
                    Q1 = quantile(rend_trabalho_principal, probs = 0.25), 
                    Q3 = quantile(rend_trabalho_principal, probs = 0.75), 
                    p95 = quantile(rend_trabalho_principal, probs = 0.95), #95º percentil
                    min = min(rend_trabalho_principal),                   
                    max = max(rend_trabalho_principal),                 
                    n = n() 
                    )

####Observação: tirei os "Na"/0 porque não parece coerente comparar a renda do trabalho de observações sem renda do trabalho (recorte)

#Calcular média, mediana, desvio padrão, 5º percentil, 1º quartil, 3º quartil, 95º percentil, mínimo, máximo e número de observações (n) para a renda total (genero e sexo)
r_total <- total  |> filter(!is.na(rendimento_todas_fontas) & rendimento_todas_fontas != 0) |> group_by( raca, sexo) |> 
  summarise( media = mean(rendimento_todas_fontas),                                                                  mediana = median(rendimento_todas_fontas) ,                                               
             dp = sd(rendimento_todas_fontas),
             p5 = quantile(rendimento_todas_fontas, probs = 0.05), #5º percentil
             Q1 = quantile(rendimento_todas_fontas, probs = 0.25), 
             Q3 = quantile(rendimento_todas_fontas, probs = 0.75), 
             p95 = quantile(rendimento_todas_fontas, probs = 0.95), #95º percentil
             min = min(rendimento_todas_fontas),                   
             max = max(rendimento_todas_fontas),                                  
             n = n() 
           )

####Observação: tirei os "Na"/0 porque não parece coerente comparar a renda observações sem renda (recorte)

##Comparando as duas tabelas dá para notar diferença da participação de outras rendas entre os sexos e "raças"

##Tabela descritiva

# vizualizar tabela com as estatísticas considerando renda do trabalho principal (exceto NA e 0)
knitr::kable(head(r_trabalho, n = nrow(r_trabalho)), 
    caption = "Estatísticas sobre Desigualdade de Renda (Gênero e Raça) a partir da Renda do Trabalho Principal")  # (exceto NA e 0)

knitr::kable(head(r_total, n = nrow(r_total)), 
    caption = "Estatísticas sobre Desigualdade de Renda (Gênero e Raça) a partir da Renda Total")  # (exceto NA e 0)

###Se estiver usando o modo escuro do R precisaria editar a tabela com o Kableextra e até para um refinamento melhor do design até para não exportar os dados resumidos e fazer a tabela em outro programa. Dito isso, eu uso a visualização Dracula do R e ainda assim dá para ver. Além da possibilidade de abrir a tabela pelo RStudio mesmo ou exportar como Word/PDF que não deve ter problema de visualização.

#Juntar tabelas
tabela_final <- merge( r_total, r_trabalho, by = c("raca", "sexo"), suffix = c("_Rtotal", "_Rtrabalho"))

#fazer visualização das tabelas
knitr::kable(head(tabela_final, n = nrow(tabela_final)), 
    caption = "Estatísticas sobre Desigualdade de Renda (Gênero e Raça): Renda Total e Renda do Trabalho Principal")  # Ficou muito informação!


tabela_final2 <- select(tabela_final, raca, sexo, media_Rtrabalho, media_Rtotal, mediana_Rtrabalho, mediana_Rtotal,p5_Rtrabalho, p5_Rtotal, p95_Rtrabalho, p95_Rtotal, max_Rtrabalho, max_Rtotal, n_Rtrabalho, n_Rtotal, )
#Foram excluídos Na´s e 0 em ambas as bases (r_total e r_trabalho)
#Uma pessoa pode estar desempregada e ganhar 10 reais por mês na renda total enquanto outra pessoa pode estar empregada e ganhar 12 reais (isso explicaria o mínimo da renda total ser menor que o do trabalho, ao menos logicamente)

#fazer visualização das tabelas
knitr::kable(head(tabela_final2, n = nrow(tabela_final2)), 
    caption = "Estatísticas sobre Desigualdade de Renda (Gênero e Raça): Renda Total e Renda do Trabalho Principal")  # Mais Clean :)

#Ainda assim recomendo clicar em "Show in New Window" (ícone próximo ao "x" sobre o gráfico)


```

## Gráfico que ilustre diferença de renda por raça e gênero

Pensei em fazer boxplots diferenciando gêneros (Homem e Mulher) e "raças" (Branco, Amerelo, Indígena e Negro)

```{r}

##Usei a base com renda (baseCR) porque não tem rendimentos (total) igual a zero/NA
  ggplot(baseCR, aes(x = raca, y = rendimento_todas_fontas, fill = sexo)) +
  geom_boxplot() +
  scale_y_log10() +  # Para melhor vizualização
  labs(title = "Boxplot de Renda por Sexo e Raça", x = "Raça", y = "Renda (log)")

```
